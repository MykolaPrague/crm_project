{% extends "base.html" %}
{% block content %}
<h1>–ö–ª—ñ—î–Ω—Ç–∏</h1>

<form method="get" class="grid" style="align-items:end; gap: 1rem;">
  <div>
    <label for="q">–ü–æ—à—É–∫</label>
    <input id="q" type="search" name="q" value="{{ q }}" placeholder="–Ü–º'—è, —Ç–µ–ª–µ—Ñ–æ–Ω –∞–±–æ email">
  </div>
  <div>
    <button type="submit">–ó–Ω–∞–π—Ç–∏</button>
    <a href="{% url 'client_list' %}" role="button" class="secondary">–°–∫–∏–Ω—É—Ç–∏</a>
  </div>
  <div style="text-align:right;">
    {% if user.is_staff or user.is_superuser %}
      <a href="{% url 'client_create' %}" role="button">+ –ù–æ–≤–∏–π –∫–ª—ñ—î–Ω—Ç</a>
    {% endif %}
  </div>
</form>

<div class="table-wrap">
<table>
  <thead>
    <tr>
      <th>
        <a href="?q={{ q }}&sort={% if sort == 'name' %}-name{% elif sort == '-name' %}name{% else %}name{% endif %}">
          –Ü–º‚Äô—è {% if sort == 'name' %}‚Üë{% elif sort == '-name' %}‚Üì{% else %}‚Üï{% endif %}
        </a>
      </th>
      <th>
        <a href="?q={{ q }}&sort={% if sort == 'phone' %}-phone{% elif sort == '-phone' %}phone{% else %}phone{% endif %}">
          –¢–µ–ª–µ—Ñ–æ–Ω {% if sort == 'phone' %}‚Üë{% elif sort == '-phone' %}‚Üì{% else %}‚Üï{% endif %}
        </a>
      </th>
      <th>
        <a href="?q={{ q }}&sort={% if sort == 'email' %}-email{% elif sort == '-email' %}email{% else %}email{% endif %}">
          Email {% if sort == 'email' %}‚Üë{% elif sort == '-email' %}‚Üì{% else %}‚Üï{% endif %}
        </a>
      </th>
      <th>
        <a href="?q={{ q }}&sort={% if sort == 'deal' %}-deal{% elif sort == '-deal' %}deal{% else %}deal{% endif %}">
          –£–≥–æ–¥–∞ {% if sort == 'deal' %}‚Üë{% elif sort == '-deal' %}‚Üì{% else %}‚Üï{% endif %}
        </a>
      </th>
      <th>
        <a href="?q={{ q }}&sort={% if sort == 'created_at' %}-created_at{% elif sort == '-created_at' %}created_at{% else %}-created_at{% endif %}">
          –°—Ç–≤–æ—Ä–µ–Ω–æ {% if sort == 'created_at' %}‚Üë{% elif sort == '-created_at' %}‚Üì{% else %}‚Üï{% endif %}
        </a>
      </th>
      {% if user.is_staff or user.is_superuser %}<th></th>{% endif %}
    </tr>
  </thead>
  <tbody>
    {% for c in page_obj.object_list %}
      <tr>
        <td><a href="{% url 'client_detail' c.pk %}">{{ c.name }}</a></td>
        <td>{{ c.phone|default:"‚Äî" }}</td>
        <td>{{ c.email|default:"‚Äî" }}</td>
        <td>
          {% if c.deal_status == "done" %}‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
          {% elif c.deal_status == "active" %}üîÑ –¢—Ä–∏–≤–∞—î
          {% elif c.deal_status == "pause" %}‚è∏Ô∏è –ü–∞—É–∑–∞
          {% else %}‚ùå –ù–µ–º–∞—î
          {% endif %}
        </td>
        <td>{{ c.created_at|date:"Y-m-d H:i" }}</td>
        {% if user.is_staff or user.is_superuser %}
          <td style="white-space:nowrap">
            <a href="{% url 'client_edit' c.pk %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a> |
            <a href="{% url 'client_delete' c.pk %}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
          </td>
        {% endif %}
      </tr>
    {% empty %}
      <tr><td colspan="6">–ù–µ–º–∞—î –∫–ª—ñ—î–Ω—Ç—ñ–≤</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>

{% if page_obj.paginator.num_pages > 1 %}
<nav aria-label="–ü–∞–≥—ñ–Ω–∞—Ü—ñ—è">
  <ul>
    {% if page_obj.has_previous %}
      <li><a href="?q={{ q }}&sort={{ sort }}&page={{ page_obj.previous_page_number }}">–ù–∞–∑–∞–¥</a></li>
    {% endif %}
    <li>–°—Ç–æ—Ä—ñ–Ω–∫–∞ {{ page_obj.number }} –∑ {{ page_obj.paginator.num_pages }}</li>
    {% if page_obj.has_next %}
      <li><a href="?q={{ q }}&sort={{ sort }}&page={{ page_obj.next_page_number }}">–î–∞–ª—ñ</a></li>
    {% endif %}
  </ul>
</nav>
{% endif %}
{% endblock %}
