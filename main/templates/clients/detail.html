{% extends "base.html" %}
{% block content %}
<h1>{{ client.name }}</h1>
<p>
  <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ client.phone|default:"‚Äî" }}<br>
  <strong>Email:</strong> {{ client.email|default:"‚Äî" }}<br>
  <strong>–°—Ç–∞—Ç—É—Å —É–≥–æ–¥–∏:</strong>
  {% if client.deal_status == "done" %}‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ
  {% elif client.deal_status == "active" %}üîÑ –¢—Ä–∏–≤–∞—î
  {% elif client.deal_status == "pause" %}‚è∏Ô∏è –ü–∞—É–∑–∞
  {% else %}‚ùå –ù–µ–º–∞—î
  {% endif %}
</p>

<div class="grid" style="margin-bottom:1rem;">
  <a href="{% url 'client_list' %}" role="button" class="secondary">‚Üê –î–æ —Å–ø–∏—Å–∫—É</a>
  {% if user.is_staff or user.is_superuser %}
    <a href="{% url 'deal_create_for_client' client.pk %}" role="button">+ –ù–æ–≤–∞ —É–≥–æ–¥–∞</a>
    <a href="{% url 'client_edit' client.pk %}" role="button" class="contrast">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞</a>
  {% endif %}
</div>

<h3>–£–≥–æ–¥–∏</h3>
<table>
  <thead>
    <tr>
      <th>–ù–∞–∑–≤–∞</th>
      <th>–°—É–º–∞</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
      {% if user.is_staff or user.is_superuser %}<th></th>{% endif %}
    </tr>
  </thead>
  <tbody>
    {% for d in deals %}
      <tr>
        <td><a href="{% url 'deal_detail' d.pk %}">{{ d.title }}</a></td>
        <td>{{ d.amount }}</td>
        <td>
          {% if user.is_staff or user.is_superuser %}
            <form method="post" action="{% url 'deal_change_status' d.pk %}">
              {% csrf_token %}
              <select name="status" onchange="this.form.submit()">
                <option value="new" {% if d.status == "new" %}selected{% endif %}>üÜï –ù–æ–≤–∏–π</option>
                <option value="in_progress" {% if d.status == "in_progress" %}selected{% endif %}>üîÑ –í —Ä–æ–±–æ—Ç—ñ</option>
                <option value="closed" {% if d.status == "closed" %}selected{% endif %}>‚úÖ –ó–∞–∫—Ä–∏—Ç–æ</option>
              </select>
            </form>
          {% else %}
            {% if d.status == "closed" %}‚úÖ –ó–∞–∫—Ä–∏—Ç–æ
            {% elif d.status == "in_progress" %}üîÑ –í —Ä–æ–±–æ—Ç—ñ
            {% else %}üÜï –ù–æ–≤–∏–π
            {% endif %}
          {% endif %}
        </td>
        <td>{{ d.created_at|date:"Y-m-d H:i" }}</td>
        {% if user.is_staff or user.is_superuser %}
          <td style="white-space:nowrap">
            <a href="{% url 'deal_edit' d.pk %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a> |
            <a href="{% url 'deal_delete' d.pk %}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
          </td>
        {% endif %}
      </tr>
    {% empty %}
      <tr><td colspan="5">–£–≥–æ–¥ –ø–æ–∫–∏ –Ω–µ–º–∞—î</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
