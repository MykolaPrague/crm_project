{% load i18n %}
{% extends "base.html" %}
{% block content %}
<h1>{{ client.name }}</h1>
<p>
  <strong>{% trans "–¢–µ–ª–µ—Ñ–æ–Ω:" %}</strong> {{ client.phone|default:"‚Äî" }}<br>
  <strong>{% trans "Email:" %}</strong> {{ client.email|default:"‚Äî" }}<br>
  <strong>{% trans "–°—Ç–∞—Ç—É—Å —É–≥–æ–¥–∏:" %}</strong>
  {% if client.deal_status == "done" %}{% trans "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ" %}
  {% elif client.deal_status == "active" %}{% trans "üîÑ –¢—Ä–∏–≤–∞—î" %}
  {% elif client.deal_status == "pause" %}{% trans "‚è∏Ô∏è –ü–∞—É–∑–∞" %}
  {% else %}{% trans "‚ùå –ù–µ–º–∞—î" %}
  {% endif %}
</p>

<div class="grid" style="margin-bottom:1rem;">
  <a href="{% url 'client_list' %}" role="button" class="secondary">{% trans "‚Üê –î–æ —Å–ø–∏—Å–∫—É" %}</a>
  {% if user.is_staff or user.is_superuser %}
    <a href="{% url 'deal_create_for_client' client.pk %}" role="button">{% trans "+ –ù–æ–≤–∞ —É–≥–æ–¥–∞" %}</a>
    <a href="{% url 'client_edit' client.pk %}" role="button" class="contrast">{% trans "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∞" %}</a>
  {% endif %}
</div>

<h3>{% trans "–£–≥–æ–¥–∏" %}</h3>
<table>
  <thead>
    <tr>
      <th>{% trans "–ù–∞–∑–≤–∞" %}</th>
      <th>{% trans "–°—É–º–∞" %}</th>
      <th>{% trans "–°—Ç–∞—Ç—É—Å" %}</th>
      <th>{% trans "–°—Ç–≤–æ—Ä–µ–Ω–æ" %}</th>
      {% if user.is_staff or user.is_superuser %}<th></th>{% endif %}
    </tr>
  </thead>
  <tbody>
    {% for d in deals %}
      <tr>
        <td><a href="{% url 'deal_detail' d.pk %}">{{ d.title }}</a></td>
        <td>{{ d.amount }}</td>
        <td>
          {% if user.is_staff or user.is_superuser %}
            <form method="post" action="{% url 'deal_change_status' d.pk %}">
              {% csrf_token %}
              <select name="status" onchange="this.form.submit()">
                <option value="new" {% if d.status == "new" %}selected{% endif %}>{% trans "üÜï –ù–æ–≤–∏–π" %}</option>
                <option value="in_progress" {% if d.status == "in_progress" %}selected{% endif %}>{% trans "üîÑ –í —Ä–æ–±–æ—Ç—ñ" %}</option>
                <option value="closed" {% if d.status == "closed" %}selected{% endif %}>{% trans "‚úÖ –ó–∞–∫—Ä–∏—Ç–æ" %}</option>
              </select>
            </form>
          {% else %}
            {% if d.status == "closed" %}{% trans "‚úÖ –ó–∞–∫—Ä–∏—Ç–æ" %}
            {% elif d.status == "in_progress" %}{% trans "üîÑ –í —Ä–æ–±–æ—Ç—ñ" %}
            {% else %}{% trans "üÜï –ù–æ–≤–∏–π" %}
            {% endif %}
          {% endif %}
        </td>
        <td>{{ d.created_at|date:"Y-m-d H:i" }}</td>
        {% if user.is_staff or user.is_superuser %}
          <td style="white-space:nowrap">
            <a href="{% url 'deal_edit' d.pk %}">{% trans "–†–µ–¥–∞–≥—É–≤–∞—Ç–∏" %}</a> |
            <a href="{% url 'deal_delete' d.pk %}">{% trans "–í–∏–¥–∞–ª–∏—Ç–∏" %}</a>
          </td>
        {% endif %}
      </tr>
    {% empty %}
      <tr><td colspan="5">{% trans "–£–≥–æ–¥ –ø–æ–∫–∏ –Ω–µ–º–∞—î" %}</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
